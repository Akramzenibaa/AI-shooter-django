{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load account %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/landing.css' %}">
<link rel="stylesheet" href="{% static 'css/auth.css' %}">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="hero-bg-glow"></div>

    <div class="auth-card">
        <div style="display: flex; justify-content: center; margin-bottom: 2rem;">
            <div
                style="padding: 1rem; background: var(--glass); border-radius: 1rem; border: 1px solid var(--glass-border); color: var(--primary);">
                <i data-lucide="key-round" style="width: 32px; height: 32px;"></i>
            </div>
        </div>

        <h1 class="auth-title">
            {% if token_fail %}
            Bad Token
            {% else %}
            Change Password
            {% endif %}
        </h1>

        {% if token_fail %}
        {% url 'account_reset_password' as reset_url %}
        <p class="auth-subtitle">
            The password reset link was invalid, possibly because it has already been used. Please request a
            <a href="{{ reset_url }}" style="color: var(--primary); text-decoration: none; font-weight: 500;">
                new password reset
            </a>.
        </p>
        {% else %}
        <form method="POST" action="{{ action_url }}" class="auth-form">
            {% csrf_token %}

            {% if form.errors %}
            <div class="error-box">
                {% for field in form %}
                {% for error in field.errors %}
                <p>{{ error }}</p>
                {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}

            {% for hidden in form.hidden_fields %}
            {{ hidden }}
            {% endfor %}

            {% for field in form.visible_fields %}
            <div class="form-group">

                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <input type="{{ field.field.widget.input_type|default:'password' }}" name="{{ field.name }}"
                    id="{{ field.id_for_label }}" {% if field.field.required %}required{% endif %} class="styled-input"
                    placeholder="{{ field.label }}">
                {% if field.help_text %}
                <div class="help-text">{{ field.help_text|safe }}</div>
                {% endif %}
            </div>
            {% endfor %}

            <button class="submit-btn" type="submit">Change Password</button>
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/password_toggle.js' %}"></script>
<script>
    lucide.createIcons();
</script>
{% endblock %}